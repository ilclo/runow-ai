{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "runow ui schema v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["ui_schema_version","screen","blocks"],
  "properties": {
    "ui_schema_version": { "const": "1.0.0" },
    "screen": { "type": "string", "minLength": 1 },
    "density": { "type": "string", "enum": ["compact","default","airy"] },
    "blocks": { "type": "array", "items": { "$ref": "#/$defs/Block" } }
  },
  "$defs": {
    "Icon": { "type": "string", "pattern": "^[a-z0-9_]+$" },
    "ActionId": { "type": "string" },
    "Bind": { "type": "string", "pattern": "^[A-Za-z0-9_.]+$" },
    "Span": { "type": "integer", "minimum": 1, "maximum": 12 },
    "Size": { "type": "string", "enum": ["sm","md","lg"] },

    "Block": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/$defs/AppBar" },
        { "$ref": "#/$defs/Tabs" },
        { "$ref": "#/$defs/SectionHeader" },
        { "$ref": "#/$defs/MetricsGrid" },
        { "$ref": "#/$defs/ButtonRow" },
        { "$ref": "#/$defs/ChipRow" },
        { "$ref": "#/$defs/Toggle" },
        { "$ref": "#/$defs/Slider" },
        { "$ref": "#/$defs/List" },
        { "$ref": "#/$defs/Carousel" },
        { "$ref": "#/$defs/Spacer" },
        { "$ref": "#/$defs/Divider" },

        { "$ref": "#/$defs/IconButton" },
        { "$ref": "#/$defs/Card" },
        { "$ref": "#/$defs/DividerV" },
        { "$ref": "#/$defs/Fab" },
        { "$ref": "#/$defs/Menu" }
      ]
    },

    "AppBar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","title"],
      "properties": {
        "type": { "const": "AppBar" },
        "title": { "type": "string" },
        "subtitle": { "type": "string" },
        "actions": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["icon","actionId"],
            "properties": {
              "icon": { "$ref": "#/$defs/Icon" },
              "actionId": { "$ref": "#/$defs/ActionId" }
            }
          }
        }
      }
    },

    "Tabs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","tabs"],
      "properties": {
        "type": { "const": "Tabs" },
        "tabs": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["key","label","blocks"],
            "properties": {
              "key": { "type": "string" },
              "label": { "type": "string" },
              "blocks": { "type": "array", "items": { "$ref": "#/$defs/Block" } }
            }
          }
        }
      }
    },

    "SectionHeader": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","title"],
      "properties": {
        "type": { "const": "SectionHeader" },
        "title": { "type": "string" },
        "subtitle": { "type": "string" }
      }
    },

    "MetricsGrid": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","columns","tiles"],
      "properties": {
        "type": { "const": "MetricsGrid" },
        "columns": { "type": "integer", "minimum": 1, "maximum": 3 },
        "tiles": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["metric","label"],
            "properties": {
              "metric": { "type": "string" },
              "label": { "type": "string" },
              "span": { "$ref": "#/$defs/Span" }
            }
          }
        }
      }
    },

    "ButtonRow": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","buttons"],
      "properties": {
        "type": { "const": "ButtonRow" },
        "align": { "type": "string", "enum": ["start","center","end","space_between"] },
        "buttons": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["label","style","actionId"],
            "properties": {
              "label": { "type": "string" },
              "style": { "type": "string", "enum": ["primary","tonal","outlined","text"] },
              "icon": { "$ref": "#/$defs/Icon" },
              "size": { "$ref": "#/$defs/Size" },
              "tint": { "type": "string", "enum": ["default","success","warning","error"] },
              "confirm": { "type": "boolean" },
              "actionId": { "$ref": "#/$defs/ActionId" }
            }
          }
        }
      }
    },

    "ChipRow": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","chips"],
      "properties": {
        "type": { "const": "ChipRow" },
        "chips": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["label","bind"],
            "properties": {
              "label": { "type": "string" },
              "icon": { "$ref": "#/$defs/Icon" },
              "bind": { "$ref": "#/$defs/Bind" },
              "value": { "type": ["string","number","boolean"] }
            }
          }
        }
      }
    },

    "Toggle": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","label","bind"],
      "properties": {
        "type": { "const": "Toggle" },
        "label": { "type": "string" },
        "bind": { "$ref": "#/$defs/Bind" }
      }
    },

    "Slider": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","label","min","max","bind"],
      "properties": {
        "type": { "const": "Slider" },
        "label": { "type": "string" },
        "min": { "type": "number" },
        "max": { "type": "number" },
        "step": { "type": "number" },
        "unit": { "type": "string" },
        "bind": { "$ref": "#/$defs/Bind" }
      }
    },

    "List": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","items"],
      "properties": {
        "type": { "const": "List" },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["icon","title","actionId"],
            "properties": {
              "icon": { "$ref": "#/$defs/Icon" },
              "title": { "type": "string" },
              "subtitle": { "type": "string" },
              "actionId": { "$ref": "#/$defs/ActionId" }
            }
          }
        }
      }
    },

    "Carousel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","images"],
      "properties": {
        "type": { "const": "Carousel" },
        "aspectRatio": { "type": "string", "pattern": "^[0-9]+:[0-9]+$" },
        "images": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["src"],
            "properties": {
              "src": { "type": "string" },
              "caption": { "type": "string" }
            }
          }
        }
      }
    },

    "Spacer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","height"],
      "properties": {
        "type": { "const": "Spacer" },
        "height": { "type": "number", "minimum": 0 }
      }
    },

    "Divider": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": { "type": { "const": "Divider" } }
    },

    /* ===== new: IconButton ===== */
    "IconButton": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","icon"],
      "properties": {
        "type": { "const": "IconButton" },
        "icon": { "$ref": "#/$defs/Icon" },
        "actionId": { "$ref": "#/$defs/ActionId" },
        "openMenuId": { "type": "string" },
        "span": { "$ref": "#/$defs/Span" }
      }
    },

    /* ===== new: Card ===== */
    "Card": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","blocks"],
      "properties": {
        "type": { "const": "Card" },
        "variant": { "type": "string", "enum": ["elevated","outlined","filled"], "default": "elevated" },
        "clickActionId": { "$ref": "#/$defs/ActionId" },
        "span": { "$ref": "#/$defs/Span" },
        "blocks": { "type": "array", "items": { "$ref": "#/$defs/Block" } }
      }
    },

    /* ===== new: DividerV ===== */
    "DividerV": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": { "const": "DividerV" },
        "thickness": { "type": "number", "default": 1 },
        "height": { "type": "number", "default": 24 }
      }
    },

    /* ===== new: Fab ===== */
    "Fab": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","icon","actionId"],
      "properties": {
        "type": { "const": "Fab" },
        "icon": { "$ref": "#/$defs/Icon" },
        "label": { "type": "string" },
        "size": { "type": "string", "enum": ["small","regular","large"], "default": "regular" },
        "variant": { "type": "string", "enum": ["regular","extended"], "default": "regular" },
        "actionId": { "$ref": "#/$defs/ActionId" }
      }
    },

    /* ===== new: Menu ===== */
    "Menu": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type","id","items"],
      "properties": {
        "type": { "const": "Menu" },
        "id": { "type": "string" },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["label","actionId"],
            "properties": {
              "icon": { "$ref": "#/$defs/Icon" },
              "label": { "type": "string" },
              "actionId": { "$ref": "#/$defs/ActionId" }
            }
          }
        }
      }
    }
  }
}
